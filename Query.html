<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Query Page</title>

    <!-- Link to shared CSS -->
    <link rel="stylesheet" href="styles/common.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"></script>
    <!-- Link to shared JavaScript -->
    <script src="scripts/common.js" defer></script>
</head>
<body>
    <div class="header-container">
        <div class="header-left"></div>
        <img src="logo.jpg" alt="Logo">
        <div class="header-right">
            <h3>Query</h3>
            <div class="settings-icon">
                <i class="fa-solid fa-gear"></i>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="query">
            <textarea class="que" placeholder="Enter Stock Symbol"></textarea>
        </div>
        <div class="btns">
            <button class="btns1" onclick="handleQuery()">Search</button>
        </div>
    </div>

    <div class="footer-container">
        <div class="footer-icon">
            <i class="fa-solid fa-circle-left"></i>
        </div>
    </div>

    <script>
        async function handleQuery() {
            const queryText = document.querySelector(".que").value;
            if (!queryText) return alert("Please enter a stock symbol");

            const data = await fetchData("http://127.0.0.1:5000/predict", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ ticker: queryText })
            });

            if (data && !data.error) {
                alert(`
                    Market Trend: ${data.market_trend}
                    Tomorrow Open: ₹${data.tomorrow_open.toFixed(2)}
                    Tomorrow Close: ₹${data.tomorrow_close.toFixed(2)}
                    Next Month Prediction: ${data.next_month.map(x => "₹" + x.toFixed(2)).join(", ")}
                    Confidence Range: ₹${data.confidence_range[0].toFixed(2)} - ₹${data.confidence_range[1].toFixed(2)}
                `);
            } else if (data && data.error) {
                alert(`⚠️ ${data.error}`);
            }
        }
    </script>
</body>
</html>
